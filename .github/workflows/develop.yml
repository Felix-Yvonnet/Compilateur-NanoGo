name: Yaml

on: push

concurrency:
  #Â any in-progress job or run
  group: ${{ github.ref }}
  # interrompt pipeline si nouveau commit
  cancel-in-progress: true
        

jobs:
	build:
		runs-on: ubuntu-latest

	steps:
	- name: Checkout
	  uses: action/checkout@v3

	- name: Use OCaml
	  uses: ocaml/setup-ocaml@v2
	  with:
		ocaml-compiler: 4.08.x
		dune-cache: true
		opam-depext-flags: --with-test

        
    - run: opam pin add yaml.dev -n .
    - run: opam pin add yaml-sexp.dev -n .
    - name: Packages
      run: opam depext -yt yaml yaml-sexp
    - name: Dependencies
      run: opam install -t . --deps-only
    - name: Build
      run: opam exec -- dune build
    - name: Test
      run: opam exec -- dune runtest

	- run: ./tests/launch.sh

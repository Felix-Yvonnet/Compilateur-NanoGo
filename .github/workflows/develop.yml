name: develop

on: push

concurrency:
  # any in-progress job or run
  group: ${{ github.ref }}
  # interrompt pipeline si nouveau commit
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
  
    # On récupère le code
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Use OCaml
      uses: ocaml/setup-ocaml@v2
      with:
        ocaml-compiler: 4.08.x
        dune-cache: true
        opam-depext-flags: --with-test
    
    - run: opam install . --deps-only

    # Check with OCamlformat 
    #- name: Lint fmt
    #  uses: ocaml/setup-ocaml/lint-fmt@v2

    - run: opam depext --install ocamlformat=$(awk -F = '/^version=/{print $2}' .ocamlformat)

    - run: opam exec -- dune build @fmt

    # On peut/doit mettre des name:
    - run: ./tests/launch.sh